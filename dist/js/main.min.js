function get_input_parameters(a){var b={};switch(a){case"land_name":b.name_input='"Название лендинга"',b.min_length=land_name_min_length,b.max_length=land_name_max_length,b.type_of_input="textarea";break;case"domain":b.name_input='"Домен лендинга"',b.min_length=0,b.max_length=domain_max_length,b.type_of_input="domain";break;case"descriptor":b.name_input='"Дескриптор"',b.min_length=textarea_min_length,b.max_length=descriptor_max_length,b.type_of_input="textarea";break;case"page_title":b.name_input='"Заголовок страницы"',b.min_length=textarea_min_length,b.max_length=descriptor_max_length,b.type_of_input="textarea";break;case"what_sell":b.name_input='"Что Вы продаете?"',b.min_length=textarea_min_length,b.max_length=textarea_max_length,b.type_of_input="textarea";break;case"what_buy":b.name_input='"Что покупает клиент?"',b.min_length=textarea_min_length,b.max_length=textarea_max_length,b.type_of_input="textarea";break;case"what_take":b.name_input='"Что получает клиент?"',b.min_length=textarea_min_length,b.max_length=textarea_max_length,b.type_of_input="textarea";break;case"offer_h1":b.name_input='"Оффер основа"',b.min_length=textarea_min_length,b.max_length=offer_h1_max_length,b.type_of_input="textarea";break;case"offer_h2":b.name_input='"Оффер преимущество"',b.min_length=textarea_min_length,b.max_length=offer_h2_max_length,b.type_of_input="textarea";break;case"ph1":b.name_input='"Код страны(телефон)"',b.min_length=ph1_min_length,b.max_length=ph1_max_length,b.type_of_input="phonepart";break;case"ph2":b.name_input='"Код города(телефон)"',b.min_length=ph2_min_length,b.max_length=ph2_max_length,b.type_of_input="phonepart";break;case"ph3":b.name_input='"Номер телефона"',b.min_length=ph3_min_length,b.max_length=ph3_max_length,b.type_of_input="phonepart";break;case"act_email":b.name_input='"Емейл для заявок"',b.min_length=email_min_length,b.max_length=email_max_length,b.type_of_input="email";break;case"email":b.name_input='"Емейл"',b.min_length=email_min_length,b.max_length=email_max_length,b.type_of_input="email";break;case"page_email":b.name_input='"Емейл на странице"',b.min_length=email_alt_min_length,b.max_length=email_max_length,b.type_of_input="email";break;case"page_addr":b.name_input='"Адрес на странице"',b.min_length=textarea_min_length,b.max_length=addr_max_length,b.type_of_input="textarea";break;case"login":b.name_input='"Логин"',b.min_length=email_min_length,b.max_length=email_max_length,b.type_of_input="textarea";break;case"pass":b.name_input='"Пароль"',b.min_length=pass_min_length,b.max_length=pass_max_length,b.type_of_input="pass";break;case"video":b.name_input='"Продающее видео"',b.min_length=video_min_length,b.max_length=video_max_length,b.type_of_input="video";break;case"logo_img":b.name_input='"Логотип"',b.min_length=0,b.max_length=0,b.type_of_input="img";break;case"form_head":b.name_input='"Надпись на форме"',b.min_length=form_head_min_length,b.max_length=form_head_max_length,b.type_of_input="textarea";break;case"form_button":b.name_input='"Надпись на кнопке"',b.min_length=form_button_min_length,b.max_length=form_button_max_length,b.type_of_input="textarea";break;case"bg_img_d":b.name_input='"Фон страницы"',b.min_length=0,b.max_length=0,b.type_of_input="img";break;case"bg_video":b.name_input='"Видео на фон"',b.min_length=bg_video_min_length,b.max_length=video_max_length,b.type_of_input="video";break;case"input_par_name":b.name_input='"Название поля"',b.min_length=input_par_min_length,b.max_length=input_par_max_length,b.type_of_input="input_par";break;case"input_par_plac":b.name_input='"Надпись на поле"',b.min_length=input_par_min_length,b.max_length=input_par_max_length,b.type_of_input="input_par";break;case"input_count":b.name_input="",b.min_length=1,b.max_length=1,b.type_of_input="input_count"}return b}function live_validation_input(a){var b=$(a).data("input-type"),c=$(a).val(),d=get_input_parameters(b);"textarea"!=d.type_of_input&&"phonepart"!=d.type_of_input&&"email"!=d.type_of_input&&"pass"!=d.type_of_input&&"video"!=d.type_of_input&&"input_par"!=d.type_of_input||(c.length>d.max_length?($(a).addClass("error-input").addClass("error-over"),$(a).parent().children("span").addClass("error-over")):($(a).removeClass("error-input").removeClass("error-empty").removeClass("error-over"),$(a).parent().children("span").removeClass("error-over")))}function validate_input(a){var b=$(a).data("input-type"),c=$(a).val(),d=get_input_parameters(b);if("textarea"==d.type_of_input)c.length<d.min_length?$(a).addClass("error-input").addClass("error-empty"):c.length>d.max_length?$(a).addClass("error-input").addClass("error-over"):$(a).removeClass("error-input").removeClass("error-empty").removeClass("error-over");else if("phonepart"==d.type_of_input){var e=new RegExp(/^\d*$/),f=new RegExp(/^\d\d\d\-\d\d\-\d\d$/);c.length<d.min_length?$(a).addClass("error-input").addClass("error-empty"):c.length>d.max_length?$(a).addClass("error-input").addClass("error-over"):$(a).hasClass("iph3")?$(a).hasClass("iph3")?f.test(c)||$(a).addClass("error-input").addClass("error-nonum"):$(a).removeClass("error-input").removeClass("error-empty").removeClass("error-over").removeClass("error-nonum"):e.test(c)||$(a).addClass("error-input").addClass("error-nonum")}else if("email"==d.type_of_input)c.length<d.min_length?$(a).addClass("error-input").addClass("error-empty"):c.length>d.max_length?$(a).addClass("error-input").addClass("error-over"):c.length>0&&!validateEmail(c)?$(a).addClass("error-input").addClass("error-noemail"):$(a).removeClass("error-input").removeClass("error-empty").removeClass("error-over").removeClass("error-noemail");else if("pass"==d.type_of_input){var g=new RegExp(/^[a-zA-Z0-9_]*$/);c.length<d.min_length?$(a).addClass("error-input").addClass("error-empty"):c.length>d.max_length?$(a).addClass("error-input").addClass("error-over"):c.length>0&&!g.test(c)?$(a).addClass("error-input").addClass("error-nopass"):$(a).removeClass("error-input").removeClass("error-empty").removeClass("error-over").removeClass("error-noemail")}else"video"==d.type_of_input?"0"!=c&&c.length<d.min_length?$(a).addClass("error-input").addClass("error-empty"):c.length>d.max_length?$(a).addClass("error-input").addClass("error-over"):"0"!=c&&c.length>0&&!youtube_parser(c)?$(a).addClass("error-input").addClass("error-novideo"):$(a).removeClass("error-input").removeClass("error-empty").removeClass("error-over").removeClass("error-novideo"):"img"==d.type_of_input?""==c?$(a).addClass("error-input").addClass("error-empty"):$(a).removeClass("error-input").removeClass("error-empty"):"input_par"==d.type_of_input?"0"!=c&&c.length<d.min_length?$(a).addClass("error-input").addClass("error-empty"):"0"!=c&&c.length>d.max_length?$(a).addClass("error-input").addClass("error-over"):$(a).removeClass("error-input").removeClass("error-empty"):"input_count"==d.type_of_input?parseInt(c)>3?$(a).addClass("error-input").addClass("error-over"):$(a).removeClass("error-input").removeClass("error-empty"):"domain"==d.type_of_input&&(c.length>d.max_length?$(a).addClass("error-input").addClass("error-over"):$(a).removeClass("error-input").removeClass("error-empty").removeClass("error-over").removeClass("error-noemail"))}function validate_wrap(a,b){a.find(validation_inputs_selectors).each(function(a,b){validate_input(b)});var c=a.find(".error-input");if(0==c.length)b();else{var d=$("#errors").find("p");d.html(""),c.each(function(a,b){var c,e=$(this).data("input-type"),f=get_input_parameters(e);"textarea"==f.type_of_input?$(this).hasClass("error-empty")?(c="<span>Поле "+f.name_input+" не заполнено</span>",d.append(c)):$(this).hasClass("error-over")&&(c="<span>Превышен лимит символов ("+f.max_length+") в поле "+f.name_input+"</span>",d.append(c)):"phonepart"==f.type_of_input?$(this).hasClass("error-empty")?(c="<span>Поле "+f.name_input+" не заполнено</span>",d.append(c)):$(this).hasClass("error-over")?(c="<span>Превышен лимит символов ("+f.max_length+") в поле "+f.name_input+"</span>",d.append(c)):$(this).hasClass("error-nonum")&&(c="<span>Символы в поле "+f.name_input+" должны быть цифрами</span>",d.append(c)):"email"==f.type_of_input?$(this).hasClass("error-empty")?(c="<span>Поле "+f.name_input+" не заполнено</span>",d.append(c)):$(this).hasClass("error-over")?(c="<span>Превышен лимит символов ("+f.max_length+") в поле "+f.name_input+"</span>",d.append(c)):$(this).hasClass("error-noemail")&&(c="<span>Значение в поле "+f.name_input+" не является емейлом</span>",d.append(c)):"pass"==f.type_of_input?$(this).hasClass("error-empty")?(c="<span>Поле "+f.name_input+" не заполнено</span>",d.append(c)):$(this).hasClass("error-over")?(c="<span>Превышен лимит символов ("+f.max_length+") в поле "+f.name_input+"</span>",d.append(c)):$(this).hasClass("error-nopass")&&(c="<span>Значение в поле "+f.name_input+" должно состоять из латинских букв и цифр</span>",d.append(c)):"video"==f.type_of_input?$(this).hasClass("error-empty")?(c="<span>Поле "+f.name_input+" не заполнено</span>",d.append(c)):$(this).hasClass("error-over")?(c="<span>Превышен лимит символов ("+f.max_length+") в поле "+f.name_input+"</span>",d.append(c)):$(this).hasClass("error-novideo")&&(c="<span>Значение в поле "+f.name_input+" не ссылка на youtube</span>",d.append(c)):"img"==f.type_of_input?""==$(this).val()&&(c="<span>Поле "+f.name_input+" не заполнено</span>",d.append(c)):"input_par"==f.type_of_input?$(this).hasClass("error-empty")?(c="<span>Поле "+f.name_input+" не заполнено</span>",d.append(c)):$(this).hasClass("error-over")&&(c="<span>Превышен лимит символов ("+f.max_length+") в поле "+f.name_input+"</span>",d.append(c)):"input_count"==f.type_of_input?$(this).hasClass("error-over")&&(c="<span>Максимальное количество полей для формы - 3</span>",d.append(c)):"domain"==f.type_of_input&&($(this).hasClass("error-over")?(c="<span>Превышен лимит символов ("+f.max_length+") в поле "+f.name_input+"</span>",d.append(c)):$(this).hasClass("error-nodomain")&&(c="<span>Значение в поле "+f.name_input+" не является доменом</span>",d.append(c)))}),$("#errors").arcticmodal()}}function validateEmail(a){var b=/^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/i;return b.test(a)}function setCookie(a,b,c){var d=new Date;d.setTime(d.getTime()+60*c*1e3+18e5);var e="expires="+d.toUTCString();document.cookie=a+"="+b+";"+e+";path=/"}function getCookie(a){for(var b=a+"=",c=document.cookie.split(";"),d=0;d<c.length;d++){for(var e=c[d];" "==e.charAt(0);)e=e.substring(1);if(0==e.indexOf(b))return e.substring(b.length,e.length)}return!1}function findGetParameter(a){var b=!1,c=[];return location.search.substr(1).split("&").forEach(function(d){c=d.split("="),c[0]===a&&(b=decodeURIComponent(c[1]))}),b}function youtube_parser(a){var b=/^.*((youtu.be\/)|(v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))\??v?=?([^#\&\?]*).*/,c=a.match(b);return!(!c||11!=c[7].length)&&c[7]}function get_json(a,b,c,d,e,f,g){var h=new Date,i=h.getTime();if("get"==a){var j="";for(var k in c)""!=j&&(j+="&"),j+=k+"="+c[k];c=j}if(e)var l=!1;else{var l=!0;"post"==a&&(c=JSON.stringify(c))}if(!g){var m=new Date,n=m.getTime();$loading.appendTo("#loading_wrap").attr("data-time",n)}var o=c;$.ajax({type:a,url:b,contentType:!1,data:o,cache:l,processData:l,response:"json",success:function(a){1==a.success?(d(a),g||$("#loading_wrap").children('.loading[data-time="'+n+'"]').remove()):("undefined"!=typeof f&&f(a),g||$("#loading_wrap").children('.loading[data-time="'+n+'"]').remove())},error:function(d){({requestId:i,request:{type:a,url:b,data:o},response:$.parseJSON(d.responseText)});"undefined"!=typeof f&&f(c),$("#loading_wrap").children(".loading").remove(),$("#critical>p").html("errorId: "+i+"<br>"+$.parseJSON(d.responseText).errorMsg),$("#critical").show()}})}function init_user(){var a=getCookie("dnk_user"),b=findGetParameter("code"),c=findGetParameter("email");b.length>0&&c.length>0?validate_user(c,b):a.length>0?get_user_list(a):($("#user-init").arcticmodal(),$("#preload").fadeOut())}function validate_user(a,b){var a=findGetParameter("email"),c=findGetParameter("code"),d={email:a,code:c};get_json("get",validate_url,d,function(a){$('input[name="userKey"]').val(a.response.userKey),$("#body").show(),history.pushState("",document.title,"./"),setCookie("dnk_user",b,0),$("#logout").fadeIn(),get_user_list(a.response.userKey,!0)},!1,function(){history.pushState("",document.title,"./")})}function send_confirm(a){var b=$('input[data-input-type="email"]').val(),c={email:b};get_json("post",register_url,c,a)}function login(a,b){validate_wrap(a,function(){var c={login:a.find('input[name="login"]').val(),password:a.find('input[name="pass"]').val()};get_json("get",login_url,c,function(a){$('input[name="userKey"]').val(a.response.userKey),get_user_list(a.response.userKey),$("#login").arcticmodal("close")},!1,b)})}function get_user_list(a,b){var c={userKey:a};get_json("get",user_info,c,function(d){$('input[name="userKey"]').val(a),$("#logout").fadeIn(),setCookie("dnk_user",a,0);var e="https://atom.dnk.bz/api/v1/page/list";get_json("get",e,c,function(a){if(user_pages=a.response,b){var c=user_pages.length-1;paste_values(user_pages[c]),$("#user-list").is(":visible")&&$("#user-list").arcticmodal("close"),$("#body").attr("data-page-number",c).show(),setCookie("dnk_page_index",c,-10)}else{$("#user-list .list").html("");for(var d=a.response.length-1;d>=0;d--){var e="<span>"+a.response[d].name+"</span>",f="",g="";validate_template_content(a.response[d])&&(f='<a href="'+a.response[d].url+'" class="link" target="_blank">на сервере</a>',"undefined"!=typeof a.response[d].domain&&""!=a.response[d].domain&&"null"!=a.response[d].domain&&null!=a.response[d].domain&&a.response[d].domain.length>0&&(g='<a href="http://'+a.response[d].domain+'" class="link" target="_blank">на домене</a>'));var h="<p><span>"+e+g+f+'</span><a href="#" data-edit="'+d+'" class="button page_edit">Редактировать</a></p>';$(h).appendTo("#user-list .list")}$(".button.page_edit").unbind("click"),$(".button.page_edit").click(function(a){a.preventDefault();var b=parseInt($(this).attr("data-edit"));paste_values(user_pages[b]),$("#user-list").arcticmodal("close"),$("#body").attr("data-page-number",b).show(),setCookie("dnk_page_index",b,-10)}),$("#body").removeAttr("data-page-number").hide(),$("#user-list").arcticmodal();var i=getCookie("dnk_page_index");i.length>0&&"-1"!=i&&$('.button.page_edit[data-edit="'+i+'"]').trigger("click")}$("#preload").fadeOut()})})}function paste_values(a){clean_values(),"undefined"!=typeof a.name&&""!=a.name&&"null"!=a.name&&null!=a.name&&$('input[name="land_name"]').val(a.name),"undefined"!=typeof a.template&&""!=a.template&&"null"!=a.template&&null!=a.template&&$('input[name="template"]').val(a.template),"undefined"!=typeof a.id&&""!=a.id&&"null"!=a.id&&null!=a.id&&$('input[name="pageId"]').val(a.id),"undefined"!=typeof a.domain&&""!=a.domain&&"null"!=a.domain&&null!=a.domain&&$('input[name="domain"]').val(a.domain).attr("data-pasted-value",a.domain);var b=a.content;for(var c in b){if(b[c].toString().indexOf(" <br>")!=-1){var d=/ <br\s*[\/]?>/gi;b[c]=b[c].replace(d,"\n")}"bg_video"!=c&&"content_video"!=c||("0"!=b[c]?(b[c]=b[c].replace(b[c],"https://www.youtube.com/watch?v="+b[c]),$('.trig[data-target="'+c+'"]').hasClass("active")||$('.trig[data-target="'+c+'"]').trigger("click")):$('.trig[data-target="'+c+'"]').hasClass("active")&&$('.trig[data-target="'+c+'"]').trigger("click")),"logo_img"==c&&("0"!=b[c]?$('.trig[data-target="logo"]').hasClass("active")||$('.trig[data-target="logo"]').trigger("click"):$('.trig[data-target="logo"]').hasClass("active")&&$('.trig[data-target="logo"]').trigger("click")),"form_custom"==c&&("0"!=b[c]?$('.radio[data-input="custom"]').hasClass("active")||$('.radio[data-input="custom"]>span').trigger("click"):$('.radio[data-input="custom"]').hasClass("active")&&$('.radio[data-input="custom"]>span').trigger("click")),"form_email"==c&&("0"!=b[c]?$('.radio[data-input="email"]').hasClass("active")||$('.radio[data-input="email"]>span').trigger("click"):$('.radio[data-input="email"]').hasClass("active")&&$('.radio[data-input="email"]>span').trigger("click")),$('input[name="'+c+'"],textarea[name="'+c+'"]').val(b[c]).trigger("input"),$("#form_custom_name").val(b.form_custom_name),$("#form_custom_plac").val(b.form_custom_plac)}bind_input_listening()}function upload_img(a,b,c){var d=new FormData($(a).closest("form")[0]);if(""!=$(a).val()){if("jpg"==b)var e="image/jpeg",f="bg";else if("png"==b)var e="image/png",f="logo";var g=a.files[0],h=g.type,i=[e];if($.inArray(h,i)<0)show_alert_mess("Файл не является изображением "+b+" формата"),$(a).val("");else if(g.size>1e7)show_alert_mess("Максимальный размер файла 10МБ"),$(a).val("");else{var j=new Image;j.src=window.URL.createObjectURL(g),j.onload=function(){var a=j.naturalWidth,b=j.naturalHeight;if(window.URL.revokeObjectURL(j.src),!(a<7e3&&b<5e3))return show_alert_mess("Файл имеет слишокм большое разрешение"),!1;var e=$('input[name="userKey"]').val(),g=$('input[name="pageId"]').val(),h="https://atom.dnk.bz/api/v1/page/"+g+"/image/upload?userKey="+e+"&type="+f;get_json("post",h,d,c,!0,c)}}}}function send_full_data(a){var b=new RegExp(String.fromCharCode(10),"g"),c=$("#land_name").val(),d=$("#page_title").val(),e=$("#descriptor").val().replace(/^\s+|\s+$/g,"").replace(b," <br>"),f=$("#offer_h1").val().replace(/^\s+|\s+$/g,"").replace(b," <br>"),g=$("#offer_h2").val(),h=$("#bg_video").val(),i=$("#content_video").val(),j=$("#form_custom_name").val(),k=$("#form_custom_plac").val(),l=$("#form_head").val().replace(/^\s+|\s+$/g,"").replace(b," <br>"),m=$("#form_button").val(),n=$("#page_email").val(),o=$("#page_addr").val(),p=$("#act_email").val(),q=$("#phone_p1").val(),r=$("#phone_p2").val(),s=$("#phone_p3").val(),t=$("#domain").val(),u=$("#logo_img").val(),v=$("#bg_img_d").val(),w=$("#bg_img_m").val(),x=$("#form_email").val(),y=$("#form_custom").val(),z=$("#bg_shadow").val(),A=$("#template").val(),B=$("#userKey").val(),C=$("#pageId").val();0==n.length&&(n=p),"0"!=h&&(h=youtube_parser(h)),"0"!=i&&(i=youtube_parser(i));var D=$("#domain").attr("data-pasted-value"),E=!1;t!=D&&(E=!0);var F={page_title:d,descriptor:e,offer_h1:f,offer_h2:g,phone_p1:q,phone_p2:r,phone_p3:s,act_email:p,page_email:n,page_addr:o,content_video:i,logo_img:u,bg_img_d:v,bg_img_m:w,bg_video:h,form_head:l,form_button:m,form_email:x,form_custom:y,form_custom_name:j,form_custom_plac:k,bg_shadow:z},G={id:C,template:A,name:c,domain:t,content:F},H="https://atom.dnk.bz/api/v1/page/save?userKey="+B;get_json("post",H,G,function(){get_user_list($("#userKey").val()),1==E&&$("#show_cname").show()}),a&&a()}function show_alert_mess(a){$("#errors>p").html("<span>"+a+"</span>"),$("#errors").arcticmodal()}function create_page(){clean_values();var a=$("#userKey").val();data={name:"Moй новый сайт"};var b="https://atom.dnk.bz/api/v1/page/save?userKey="+a;get_json("post",b,data,function(){get_user_list($("#userKey").val(),!0)})}function clean_values(){unbind_input_listening();for(var a=templates_input_array.length-1;a>=0;a--){var b=templates_input_array[a];$(b.selector).val(b["default"]).trigger("input")}$("#domain").removeAttr("data-pasted-value"),$("#logo_view").removeAttr("style"),$(".trig").removeClass("active"),$('.radio[data-input="email"]').removeClass("active"),$('.radio[data-input="custom"]').removeClass("active"),$(".error-input").removeClass("error-input")}function validate_template_content(data){for(var i=templates_input_array.length-1;i>=0;i--){var inp=templates_input_array[i];if(inp.hasOwnProperty("key")){var key_name=inp.key,data_eval="data."+key_name;if("undefined"==typeof data.content||"null"==data.content||null==data.content)return!1;if("data.domain"!=data_eval){if(("undefined"==typeof eval(data_eval)||"null"==eval(data_eval)||null==eval(data_eval))&&"domain"!=data_eval)return!1;var data_value=eval(data_eval)}}}return!0}function bind_input_listening(){for(var a="",b=templates_input_array.length-1;b>=0;b--){var c=templates_input_array[b];c.hasOwnProperty("key")&&(a+=","+c.selector)}a=a.substring(1),$(a).bind("blur",input_update_on_blur)}function unbind_input_listening(){for(var a="",b=templates_input_array.length-1;b>=0;b--){var c=templates_input_array[b];c.hasOwnProperty("key")&&(a+=","+c.selector)}a=a.substring(1),$(a).unbind("blur",input_update_on_blur)}var register_url="https://atom.dnk.bz/api/v1/client/register?partnerKey=AdmThFoJQSf8TdTmBqrTOGgiwNgAnrEc",validate_url="https://atom.dnk.bz/api/v1/user/email/validate",login_url="https://atom.dnk.bz/api/v1/user/login",user_info="https://atom.dnk.bz/api/v1/user/info",validation_inputs_selectors='textarea,input.valid[type="text"],input.valid[type="password"],input.valid[type="hidden"],input.valid[type="email"]',$loading=$('<div class="loading"><div></div></div>'),textarea_min_length=5,textarea_max_length=999,descriptor_max_length=70,offer_h1_max_length=120,offer_h2_max_length=70,ph1_min_length=1,ph1_max_length=2,ph2_min_length=3,ph2_max_length=4,ph3_min_length=9,ph3_max_length=9,email_min_length=5,email_alt_min_length=0,email_max_length=40,addr_max_length=40,pass_min_length=6,pass_max_length=16,video_min_length=25,video_max_length=150,form_head_min_length=5,form_head_max_length=55,form_button_min_length=5,form_button_max_length=35,bg_video_min_length=0,input_par_min_length=3,input_par_max_length=35,land_name_min_length=3,land_name_max_length=50,domain_max_length=80;$.arcticmodal("setDefault",{closeOnOverlayClick:!1,closeOnEsc:!1,openEffect:{type:"none",speed:0},closeEffect:{type:"none",speed:0},afterOpen:function(a,b){$(b).outerHeight()>$(window).height()&&$("body").addClass("scrollpad")},afterClose:function(a,b){$("body").removeClass("scrollpad")}}),jQuery.fn.ForceNumericOnly=function(){return this.each(function(){$(this).keydown(function(a){var b=a.charCode||a.keyCode||0;return 8==b||9==b||13==b||46==b||110==b||190==b||b>=35&&b<=40||b>=48&&b<=57||b>=96&&b<=105})})};var user_pages,templates_input_array=[{selector:"#template","default":"wov",key:"template"},{selector:"#bg_shadow","default":"0.8",key:"content.bg_shadow"},{selector:"#input_count","default":"2"},{selector:"#form_email","default":"0",key:"content.form_email"},{selector:"#form_custom","default":"0",key:"content.form_custom"},{selector:"#form_custom_name","default":"0",key:"content.form_custom_name"},{selector:"#form_custom_plac","default":"0",key:"content.form_custom_plac"},{selector:"#bg_img_m","default":"",key:"content.bg_img_m"},{selector:"#bg_img_d","default":"",key:"content.bg_img_d"},{selector:"#logo_img","default":"0",key:"content.logo_img"},{selector:"#phone_p1","default":"",key:"content.phone_p1"},{selector:"#phone_p2","default":"",key:"content.phone_p2"},{selector:"#phone_p3","default":"",key:"content.phone_p3"},{selector:"#page_addr","default":"",key:"content.page_addr"},{selector:"#act_email","default":"",key:"content.act_email"},{selector:"#page_email","default":"",key:"content.page_email"},{selector:"#form_head","default":"",key:"content.form_head"},{selector:"#form_button","default":"",key:"content.form_button"},{selector:"#content_video","default":"0",key:"content.content_video"},{selector:"#bg_video","default":"0",key:"content.bg_video"},{selector:"#offer_h2","default":"",key:"content.offer_h2"},{selector:"#offer_h1","default":"",key:"content.offer_h1"},{selector:"#descriptor","default":"",key:"content.descriptor"},{selector:"#page_title","default":"",key:"content.page_title"},{selector:"#land_name","default":"",key:"name"},{selector:"#domain","default":"",key:"domain"}];input_update_on_blur=function(a){if(validate_input(this),!$(this).hasClass("error-input")){for(var b=templates_input_array.length-1;b>=0;b--){var c=templates_input_array[b];if(c.hasOwnProperty("key")&&$(this).is(c.selector)){var d,e=$("#body").attr("data-page-number"),f=$(this).val();if(c.key.indexOf("content")>-1){var g=c.key.replace("content.","");if(null==user_pages[e].content&&(user_pages[e].content={}),user_pages[e].content[g]=f,"offer_h1"==g||"form_head"==g||"descriptor"==g){var h=new RegExp(String.fromCharCode(10),"g");user_pages[e].content[g]=f.replace(/^\s+|\s+$/g,"").replace(h," <br>")}"page_email"==g&&0==f.length&&(user_pages[e].content[g]=user_pages[e].content.act_email),"bg_video"==g&&"0"!=f&&(user_pages[e].content[g]=youtube_parser(f)),"content_video"==g&&"0"!=f&&(user_pages[e].content[g]=youtube_parser(f)),d=user_pages[e].content[g]}else user_pages[e][c.key]=f,d=user_pages[e][c.key]}}var i=$("#userKey").val(),j="https://atom.dnk.bz/api/v1/page/save?userKey="+i;get_json("post",j,user_pages[e],function(){},!1,function(){},!0)}},$("img").each(function(){var a=$(this).attr("data-original");"undefined"!=typeof a&&a!==!1&&$(this).attr("src",$(this).data("original"))}),$(document).ready(function(){init_user(),$(validation_inputs_selectors).on("keyup",function(a){live_validation_input(this)}),$(".button.registration").click(function(a){a.preventDefault(),$(this).closest("#user-init").attr("data-step","1")}),$(".button.send_confirm").click(function(a){a.preventDefault();var b=this;validate_wrap($(this).closest(".step"),function(){send_confirm(function(){$(b).closest("#user-init").attr("data-step","2")})})}),$(".button.login-btn").click(function(a){a.preventDefault(),$("#user-init").arcticmodal("close"),$("#login").arcticmodal()}),$(".button.send_login").click(function(a){a.preventDefault();var b=this;login($(this).closest("#login"),function(){$(b).closest("#login").find(".valid").val("").addClass("error-input")})}),$("#errors>.close").click(function(){$("#errors").arcticmodal("close")}),$("#upfile1").change(function(a){a.preventDefault(),upload_img(this,"png",function(a){var b=a.response.desktop;$("#logo_img").val(b).trigger("input").trigger("blur")})}),$("#logo_img").on("input",function(){var a=new Date;"0"!=$(this).val()&&$("#logo_view").css("background-image","url("+$(this).val()+"?"+a.getTime()+")")}),$("#upfile2").change(function(a){a.preventDefault(),upload_img(this,"jpg",function(a){var b=(new Date,a.response.desktop),c=a.response.mobile;$("#bg_img_d").val(b).trigger("input").trigger("blur"),$("#bg_img_m").val(c).trigger("blur")})}),$("#bg_img_d").on("input",function(){var a=new Date;"0"!=$(this).val()&&$("#preview").css("background-image","url("+$(this).val()+"?"+a.getTime()+")")}),$(".trig").click(function(a){var b=$(this).data("target");$(this).hasClass("active")?($(this).removeClass("active"),"logo"==b?($("#preview").attr("data-logo","0"),$("#logo_img").val("0").trigger("input").trigger("blur")):"bg_video"==b&&$("#bg_video").val("0").trigger("blur"),"content_video"==b&&($("#content_video").val("0"),$("#template").val("wov").trigger("blur"))):($(this).addClass("active"),"logo"==b?($("#preview").attr("data-logo","1"),$("#logo_img").val("").trigger("input").trigger("blur")):"bg_video"==b&&$("#bg_video").val("").trigger("blur"),"content_video"==b&&($("#content_video").val(""),$("#template").val("wiv").trigger("blur")))}),$('textarea[name="descriptor"]').on("input",function(){var a=new RegExp(String.fromCharCode(10),"g"),b=$(this).val().replace(/^\s+|\s+$/g,"").replace(a," <br>");$("#preview .descr").html(b)}),$("#slider").slider({slide:function(a,b){$("#bg_shadow").val(b.value/100).trigger("input")},stop:function(a,b){$("#bg_shadow").trigger("blur")}}),$('input[name="bg_shadow"]').on("input",function(){$("#preview .bg-shadow").css("opacity",$(this).val()),$("#slider").slider("value",100*parseFloat($(this).val()))}),$(".radio>span").click(function(){var a=$(this).parent();if(!a.hasClass("frozen"))if(a.hasClass("active")){if(a.removeClass("active"),"email"==a.attr("data-input"))$("#form_email").val("0").trigger("blur");else if("custom"==a.attr("data-input")){$("#form_custom").val("0").trigger("blur");var b=a.find("input");b.each(function(a,b){var c=$(this).val();""==c&&$(this).val("0").trigger("blur")})}}else if(a.addClass("active"),"email"==a.attr("data-input"))$("#form_email").val("1").trigger("blur");else if("custom"==a.attr("data-input")){$("#form_custom").val("1").trigger("blur");var b=a.find("input");b.each(function(a,b){var c=$(this).val();"0"==c&&$(this).val("").trigger("blur")})}$("#input_count").val(a.parent().find(".radio.active").length)}),$(".button.button_go").click(function(a){a.preventDefault(),validate_wrap($("#body,#hidden-box"),function(){send_full_data(function(){setCookie("dnk_page_index","-1",-60)})})}),$('input[name="phone_p1"],input[name="phone_p2"]').ForceNumericOnly(),$('input[name="phone_p3"]').mask("999-99-99"),$(".button.create_new").click(function(a){a.preventDefault(),create_page()}),$("#show_cname .button").click(function(a){a.preventDefault(),$("#show_cname").hide()}),$("#critical>div").click(function(){location.reload()}),$("#logout").click(function(a){a.preventDefault(),setCookie("dnk_page_index","-1",-60),setCookie("dnk_user","-1",-60),location.reload()}),$("a.btn_back").click(function(a){a.preventDefault(),setCookie("dnk_page_index","-1",-60),get_user_list($("#userKey").val())})});